{% extends "base.html" %}
{% block content %}
{% load bootstrap_icons %}

<table class="table table-hover table-striped" id="key-table">
  <thead>
    <tr>
      <th scope="col">
        <button class="btn btn-link sort-button" data-sort="number">
          <span class="fw-bold text-dark">Nr.</span> {% bs_icon 'arrow-down-up' %}
        </button>
      </th>
      <th scope="col">
        <button class="btn btn-link sort-button" data-sort="name">
          <span class="fw-bold text-dark">Navn</span> {% bs_icon 'arrow-down-up' %}
        </button>
      </th>
      <th scope="col">
        <button class="btn btn-link sort-button" data-sort="current_user">
          <span class="fw-bold text-dark">Nuv√¶rende bruger</span> {% bs_icon 'arrow-down-up' %}
        </button>
      </th>
      <th scope="col">
        <button class="btn btn-link sort-button" data-sort="description">
          <span class="fw-bold text-dark">Beskrivelse</span> {% bs_icon 'arrow-down-up' %}
        </button>
      </th>
    </tr>
  </thead>
  <tbody>
    {% for key in key_list %}
      <tr>
        <td>{{ key.number}}</td>
        <td>{{ key.name }}</td>
        <td class="d-flex justify-content-between align-items-center">
          <span>{{ key.current_user }}</span>
          
          {% if user.is_staff %}
            <a href="{% url 'organization_Key_update' key.id %}" class="btn btn-sm btn-primary ms-2">
              rediger
            </a>
          {% endif %}
        </td>
        <td>
          {{ key.description }}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const table = document.getElementById("key-table");
    const sortButtons = table.querySelectorAll(".sort-button");
    const tbody = table.querySelector("tbody");

    sortButtons.forEach(button => {
        let ascending = true; // track sort direction

        button.addEventListener("click", function () {
            const sortBy = button.getAttribute("data-sort");
            const columnIndex = button.parentElement.cellIndex;

            // get rows as array
            const rows = [...tbody.querySelectorAll("tr")];

            const sortedRows = rows.sort((a, b) => {
                const cellA = a.cells[columnIndex].innerText.trim();
                const cellB = b.cells[columnIndex].innerText.trim();

                // determine type of sorting
                if (sortBy === "number") {
                    return ascending 
                        ? Number(cellA) - Number(cellB)
                        : Number(cellB) - Number(cellA);
                } else {
                    return ascending
                        ? cellA.localeCompare(cellB)
                        : cellB.localeCompare(cellA);
                }
            });

            // toggle ascending/descending for next click
            ascending = !ascending;

            // clear tbody and append sorted rows
            tbody.innerHTML = "";
            sortedRows.forEach(row => tbody.appendChild(row));
        });
    });
});
</script>

{% endblock %}
